<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

//Global Variables
const express = require('express');
const app = express();
const notFoundHandler = require('../middleware/404.js');
const errorHandler = require('../middleware/500.js');
const logger = require('../middleware/logger.js');
const timestamp = require('../middleware/timestamp');

//Middleware
app.use(logger);
app.use(timestamp);
app.use(express.json());

let database = [{
  categories: [],
  products: [
    {
      category_id: '1',
      price: 10,
      weight: 30,
      quantity: 10,
      id: 1,
    },
  ],
}];

//Proof of Life Route
app.get('/', (request, response) => {
  response.send('Hello World!');
});

/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const getProducts = (request, response, next) => {
  let count = database[0].products.length;
  let results = database[0].products;
  response.json({ count, results });
};
/**
 * @param {*} request
 * @param {*} response  
 * @param {*} next
 */
const postProduct = (request, response, next) => {
  let { category_id, price, weight, quantity, id } = request.body;
  let record = { category_id, price, weight, quantity, id };
  record.id = database[0].products.length;
  database[0].products.push(record);
  response.json(record);
};
/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const putProduct = (request, response, next) => {
  let idToUpdate = request.param.id;
  let { category_id, price, weight, quantity, id } = request.body;
  let updatedRecord = { category_id, price, weight, quantity, id };
  let database = database[0].products.map(record => { record.id !== parseInt(idToUpdate) ? updatedRecord : record; });
  response.json(updatedRecord);
};
/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const deleteProduct = (request, response, next) => {
  let id = request.params.id;
  database = database[0].products.filter(record => record.id !== parseInt(id));
  response.json({});
};

/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const getCategories = (request, response, next) => {
  let count = database[0].categories.length;
  let results = database[0].categories;
  response.json({ count, results });
};
/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const postCategory = (request, response, next) => {
  let { name, id } = request.body;
  let record = { name, id };
  database[0].categories.push(record);
  response.json(record);
};
/**
 * @param {*} request
 * @param {*} response
 * @param {*} next
 */
const putCategory = (request, response, next) => {
  let idToUpdate = request.param.id;
  let { name, id } = request.body;
  let updatedRecord = { name, id };
  let database = database[0].categories.map(record => { record.id !== parseInt(idToUpdate) ? updatedRecord : record; });
  response.json(updatedRecord);
};
/**
 * @param {*} req
 * @param {*} res
 * @param {*} next
 */
const deleteCategory = (request, response, next) => {
  let id = request.params.id;
  database = database[0].categories.filter(record => record.id !== parseInt(id));
  response.json({});
};

//Product Routes
app.get('/products', timestamp, logger, getProducts);
app.post('/products', timestamp, logger, postProduct);
app.put('/products/:id', timestamp, logger, putProduct);
app.delete('./products:id', timestamp, logger, deleteProduct);

//Category Routes
app.get('/categories', timestamp, logger, getCategories);
app.post('/categories', timestamp, logger, postCategory);
app.put('/categories/:id', timestamp, logger, putCategory);
app.delete('/categories/:id', timestamp, logger, deleteCategory);

//Error Handlers
app.use('*', notFoundHandler);
app.use(errorHandler);

//Port Listener
module.exports = {
  server: app,
  start: port => {
    let PORT = port || process.env.PORT || 3000;
    app.listen(PORT, () => console.log(`Listening again, on port ${PORT}`));
  },
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-categories.html">categories</a></li><li><a href="module-Model%2520-%2520exports%2520Model.html">Model - exports Model</a></li></ul><h3>Classes</h3><ul><li><a href="Categories.html">Categories</a></li><li><a href="Model.html">Model</a></li><li><a href="Model.Model.html">Model</a></li></ul><h3>Global</h3><ul><li><a href="global.html#deleteCategory">deleteCategory</a></li><li><a href="global.html#deleteProduct">deleteProduct</a></li><li><a href="global.html#getCategories">getCategories</a></li><li><a href="global.html#getProducts">getProducts</a></li><li><a href="global.html#postCategory">postCategory</a></li><li><a href="global.html#postProduct">postProduct</a></li><li><a href="global.html#putCategory">putCategory</a></li><li><a href="global.html#putProduct">putProduct</a></li><li><a href="global.html#timeStamp">timeStamp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Feb 01 2020 20:05:42 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
